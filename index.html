<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutina de Alma y Facu</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Tipografía Base */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            /* slate-950 */
            color: #e2e8f0;
            /* slate-200 */
        }

        /* Scrollbar Personalizado */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #020617;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #10b981;
        }

        /* Utilidades para ocultar scrollbar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animaciones */
        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-slide-up {
            animation: slideUpFade 0.5s ease-out forwards;
        }

        @keyframes pop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.3);
            }

            100% {
                transform: scale(1.1);
            }
        }

        .animate-pop {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Stagger delays */
        .stagger-1 {
            animation-delay: 0.05s;
        }

        .stagger-2 {
            animation-delay: 0.1s;
        }

        .stagger-3 {
            animation-delay: 0.15s;
        }

        .stagger-4 {
            animation-delay: 0.2s;
        }

        .stagger-5 {
            animation-delay: 0.25s;
        }

        .stagger-6 {
            animation-delay: 0.3s;
        }
    </style>
</head>

<body class="selection:bg-emerald-500 selection:text-white pb-20 md:pb-0 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-slate-900 border-b border-slate-800 sticky top-0 z-20 shadow-lg backdrop-blur-sm bg-opacity-90">
        <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="animate-slide-up">
                <h1 class="text-xl md:text-2xl font-bold text-emerald-400 flex items-center gap-2">
                    <i data-lucide="activity" class="w-6 h-6 animate-pulse"></i>
                    Rutina de Alma y Facu
                </h1>
                <p class="text-xs text-slate-400 uppercase tracking-wider font-semibold">Training System</p>
            </div>
            <div class="hidden md:block animate-slide-up stagger-1">
                <span id="current-date"
                    class="bg-slate-800 text-emerald-400 px-3 py-1 rounded-full text-sm font-medium border border-slate-700 shadow-sm capitalize">
                    <!-- Fecha inyectada por JS -->
                </span>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-6 md:py-8 flex flex-col md:flex-row gap-6 w-full flex-1">

        <!-- Sidebar / Top Tabs -->
        <nav class="md:w-64 flex-shrink-0 animate-slide-up">
            <div id="tabs-container"
                class="flex md:flex-col overflow-x-auto md:overflow-visible gap-2 pb-2 md:pb-0 scrollbar-hide">
                <!-- Botones inyectados por JS -->
            </div>
        </nav>

        <!-- Main Content -->
        <div class="flex-1 w-full">

            <!-- Progress Section -->
            <div id="progress-container"
                class="mb-6 bg-slate-900 rounded-xl p-4 border border-slate-800 shadow-sm animate-slide-up stagger-1 hidden">
                <div class="flex justify-between items-end mb-2">
                    <div>
                        <h2 id="day-title" class="text-2xl font-bold text-white flex items-center gap-2">
                            <!-- Título del día -->
                        </h2>
                        <p class="text-slate-400 text-sm mt-1 flex items-center gap-1">
                            <i data-lucide="flame" class="w-4 h-4 text-orange-500"></i>
                            <span id="exercise-count">0 Ejercicios</span>
                        </p>
                    </div>
                    <div class="text-right">
                        <span id="progress-text"
                            class="text-3xl font-bold text-emerald-400 transition-all duration-500">0%</span>
                    </div>
                </div>
                <div class="w-full bg-slate-800 rounded-full h-2.5 overflow-hidden">
                    <div id="progress-bar"
                        class="bg-emerald-500 h-2.5 rounded-full transition-all duration-1000 ease-out shadow-[0_0_10px_rgba(16,185,129,0.5)]"
                        style="width: 0%"></div>
                </div>
            </div>

            <!-- Exercises List -->
            <div id="exercises-list" class="space-y-4">
                <!-- Tarjetas inyectadas por JS -->
            </div>

            <!-- Completion Message -->
            <div id="completion-message"
                class="hidden mt-8 p-6 bg-gradient-to-r from-emerald-900/30 to-slate-900 rounded-2xl border border-emerald-900/50 text-center animate-slide-up shadow-[0_0_30px_rgba(16,185,129,0.1)]">
                <div
                    class="inline-flex items-center justify-center p-3 bg-emerald-500/20 rounded-full mb-4 animate-bounce">
                    <i data-lucide="trophy" class="w-8 h-8 text-emerald-400"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">¡Entrenamiento Completado!</h3>
                <p class="text-slate-400">Excelente trabajo hoy, Alma y Facu. ¡A recuperar!</p>
            </div>

        </div>
    </main>

    <!-- Timer Modal -->
    <div id="timer-modal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div
            class="bg-slate-900 border border-slate-700 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl shadow-emerald-500/10">
            <div class="mb-4">
                <i data-lucide="timer" class="w-12 h-12 text-emerald-400 mx-auto mb-2"></i>
                <h3 class="text-lg font-bold text-slate-300">Tiempo de Descanso</h3>
                <p id="timer-exercise-name" class="text-sm text-slate-500 truncate"></p>
            </div>
            <div id="timer-display" class="text-7xl font-mono font-bold text-emerald-400 mb-6 tabular-nums">
                0:00
            </div>
            <div id="timer-progress-ring" class="relative w-32 h-32 mx-auto mb-6">
                <svg class="w-32 h-32 transform -rotate-90">
                    <circle cx="64" cy="64" r="58" stroke="#1e293b" stroke-width="8" fill="none" />
                    <circle id="timer-ring" cx="64" cy="64" r="58" stroke="#10b981" stroke-width="8" fill="none"
                        stroke-linecap="round" stroke-dasharray="364.42" stroke-dashoffset="0"
                        class="transition-all duration-1000 ease-linear" />
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span id="timer-seconds-left" class="text-3xl font-bold text-white"></span>
                </div>
            </div>
            <div class="flex gap-3 justify-center">
                <button id="timer-skip-btn"
                    class="px-6 py-3 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl font-medium transition-all flex items-center gap-2">
                    <i data-lucide="skip-forward" class="w-4 h-4"></i>
                    Saltar
                </button>
                <button id="timer-add-btn"
                    class="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-medium transition-all flex items-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    +30s
                </button>
            </div>
        </div>
    </div>

    <div class="h-6 md:h-0"></div>

    <script>
        // --- DATA ---
        const routineData = [
            {
                day: "Lunes",
                title: "Piernas y Core",
                exercises: [
                    { name: "Sentadilla (Barra o Hack)", sets: "3", reps: "8-10", rir: "RIR 2", notes: "Facu: Barra Trasera. Alma: Hack o Smith. Romper paralelo. Descanso: 3 min.", muscles: { primary: ['quads', 'glutes'], secondary: ['hamstrings', 'lower_back'] } },
                    { name: "Hip Thrust (Máquina o Barra)", sets: "4", reps: "10-12", rir: "RIR 1-2", notes: "Usen el banco. Sostener 1 seg arriba. Mirada al frente. Descanso: 2 min.", muscles: { primary: ['glutes'], secondary: ['hamstrings'] } },
                    { name: "Prensa de Piernas", sets: "3", reps: "12-15", rir: "RIR 1", notes: "Pies ancho de hombros. Bajar lento (3 seg). Descanso: 90 seg.", muscles: { primary: ['quads'], secondary: ['glutes', 'hamstrings'] } },
                    { name: "Curl Femoral (Máquina)", sets: "3", reps: "12-15", rir: "RIR 0-1", notes: "Talones al glúteo. No despeguen la cadera del asiento. Descanso: 60-90 seg.", muscles: { primary: ['hamstrings'], secondary: ['calves'] } },
                    { name: "Crunch Abdominal en Polea", sets: "3", reps: "12-15", rir: "RIR 1", notes: "De rodillas frente a polea alta. Enrollen el torso hacia abajo. Descanso: 60 seg.", muscles: { primary: ['abs'], secondary: ['obliques'] } }
                ]
            },
            {
                day: "Martes",
                title: "Pecho y Tríceps",
                exercises: [
                    { name: "Press de Banca (Barra)", sets: "4", reps: "6-8", rir: "RIR 2", notes: "Pies firmes. Barra a la línea de las tetillas. Descanso: 3 min.", muscles: { primary: ['chest'], secondary: ['triceps', 'shoulders'] } },
                    { name: "Fondos en Paralelas (Dips)", sets: "3", reps: "Fallo/-1", rir: "RIR 1", notes: "Si cuestan mucho, usen la máquina asistida. Inclina el torso adelante. Descanso: 2 min.", muscles: { primary: ['chest', 'triceps'], secondary: ['shoulders'] } },
                    { name: "Press Inclinado (Máquina)", sets: "3", reps: "10-12", rir: "RIR 1", notes: "Enfócate en la parte alta del pecho. Movimiento controlado. Descanso: 90 seg.", muscles: { primary: ['chest'], secondary: ['triceps', 'shoulders'] } },
                    { name: "Extensiones Tríceps (Polea)", sets: "3", reps: "12-15", rir: "RIR 0", notes: "Usa la barra recta o en V. Codos pegados a costillas. Descanso: 60 seg.", muscles: { primary: ['triceps'], secondary: [] } }
                ]
            },
            {
                day: "Miércoles",
                title: "Espalda, Hombros y Pecho",
                exercises: [
                    { name: "Jalón al Pecho (Agarre Ancho)", sets: "3", reps: "10-12", rir: "RIR 2", notes: "Reemplazo de dominadas. Pecho arriba, jala a la clavícula. Descanso: 2 min.", muscles: { primary: ['lats'], secondary: ['biceps', 'forearms'] } },
                    { name: "Press Militar (Máquina)", sets: "3", reps: "10-12", rir: "RIR 1-2", notes: "Empuje vertical seguro. No arqueen la espalda. Descanso: 90 seg.", muscles: { primary: ['shoulders'], secondary: ['triceps'] } },
                    { name: "Remo en Polea Baja", sets: "3", reps: "12-15", rir: "RIR 1", notes: "Espalda recta. Jalen hacia el ombligo apretando espalda. Descanso: 90 seg.", muscles: { primary: ['lats', 'traps'], secondary: ['biceps'] } },
                    { name: "Press Pecho (Mancuernas)", sets: "3", reps: "10-12", rir: "RIR 1", notes: "Banco plano. Bajen profundo para estirar bien. Descanso: 2 min.", muscles: { primary: ['chest'], secondary: ['triceps', 'shoulders'] } },
                    { name: "Elevaciones Laterales (Mancuernas)", sets: "3", reps: "15-20", rir: "RIR 0", notes: "\"Vuelos\". Suban los codos, no las manos. Descanso: 60 seg.", muscles: { primary: ['shoulders'], secondary: ['traps'] } }
                ]
            },
            {
                day: "Jueves",
                title: "Espalda y Bíceps",
                exercises: [
                    { name: "Jalón al Pecho (Agarre Neutro)", sets: "4", reps: "8-10", rir: "RIR 1", notes: "Usa el agarre triángulo (cerrado). Jala fuerte al pecho. Descanso: 2 min.", muscles: { primary: ['lats', 'biceps'], secondary: ['forearms'] } },
                    { name: "Remo T-Bar (o Máquina Remo)", sets: "3", reps: "10-12", rir: "RIR 1-2", notes: "Pecho apoyado en el pad para proteger lumbar. Descanso: 2 min.", muscles: { primary: ['lats', 'traps'], secondary: ['biceps', 'lower_back'] } },
                    { name: "Curl Predicador (Máquina)", sets: "3", reps: "10-12", rir: "RIR 0", notes: "Banco Scott. Estira el brazo completo abajo. Descanso: 90 seg.", muscles: { primary: ['biceps'], secondary: [] } },
                    { name: "Curl Martillo (Polea con cuerda)", sets: "3", reps: "12-15", rir: "RIR 0", notes: "Polea baja con cuerda. Agarre neutro. Descanso: 60 seg.", muscles: { primary: ['biceps', 'forearms'], secondary: [] } }
                ]
            },
            {
                day: "Viernes",
                title: "Full Body",
                exercises: [
                    { name: "Peso Muerto Rumano (Mancuernas)", sets: "3", reps: "10-12", rir: "RIR 2", notes: "Cadera atrás. Rodillas semi-rígidas. Sentir el \"tirón\" atrás. Descanso: 2 min.", muscles: { primary: ['hamstrings', 'glutes'], secondary: ['lower_back'] } },
                    { name: "Press de Pecho (Máquina)", sets: "3", reps: "12-15", rir: "RIR 0", notes: "Sentados. Empujen fuerte. Mejor que flexiones. Descanso: 90 seg.", muscles: { primary: ['chest', 'triceps'], secondary: ['shoulders'] } },
                    { name: "Zancadas (Caminando c/Mancuernas)", sets: "3", reps: "12/lado", rir: "RIR 1", notes: "Pasos largos con mancuernas en las manos. Descanso: 90 seg.", muscles: { primary: ['glutes', 'quads'], secondary: ['hamstrings'] } },
                    { name: "Face Pull (Polea Alta)", sets: "3", reps: "15-20", rir: "RIR 1", notes: "Cuerda a la frente. Codos arriba y atrás. Descanso: 60 seg.", muscles: { primary: ['shoulders', 'traps'], secondary: [] } },
                    { name: "Copa Tríceps (Mancuerna)", sets: "3", reps: "12-15", rir: "RIR 0", notes: "Sentado. Mancuerna detrás de la nuca a dos manos. Descanso: 60 seg.", muscles: { primary: ['triceps'], secondary: [] } }
                ]
            }
        ];

        // --- STATE ---
        let activeTab = 0;
        let completedSets = JSON.parse(localStorage.getItem('gymRoutineSets')) || {};
        let timerInterval = null;
        let currentTimerSeconds = 0;
        let totalTimerSeconds = 0;

        // --- HELPER: Parse rest time from notes ---
        function parseRestTime(notes) {
            const match = notes.match(/Descanso:\s*(\d+)(?:-\d+)?\s*(min|seg)/i);
            if (match) {
                const value = parseInt(match[1]);
                const unit = match[2].toLowerCase();
                return unit === 'min' ? value * 60 : value;
            }
            return 90; // Default 90 seconds
        }

        // --- TIMER FUNCTIONS ---
        function showTimer(exerciseName, seconds) {
            const modal = document.getElementById('timer-modal');
            const display = document.getElementById('timer-display');
            const ring = document.getElementById('timer-ring');
            const secondsLeft = document.getElementById('timer-seconds-left');
            const exerciseNameEl = document.getElementById('timer-exercise-name');

            exerciseNameEl.textContent = exerciseName;
            currentTimerSeconds = seconds;
            totalTimerSeconds = seconds;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            lucide.createIcons();

            updateTimerDisplay();

            timerInterval = setInterval(() => {
                currentTimerSeconds--;
                updateTimerDisplay();

                if (currentTimerSeconds <= 0) {
                    clearInterval(timerInterval);
                    playTimerEnd();
                    setTimeout(hideTimer, 1500);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timer-display');
            const ring = document.getElementById('timer-ring');
            const secondsLeft = document.getElementById('timer-seconds-left');

            const mins = Math.floor(currentTimerSeconds / 60);
            const secs = currentTimerSeconds % 60;
            display.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            secondsLeft.textContent = currentTimerSeconds;

            // Update ring progress
            const circumference = 364.42;
            const progress = currentTimerSeconds / totalTimerSeconds;
            ring.style.strokeDashoffset = circumference * (1 - progress);

            // Change color when low
            if (currentTimerSeconds <= 10) {
                ring.style.stroke = '#ef4444';
                display.classList.remove('text-emerald-400');
                display.classList.add('text-red-400');
            } else {
                ring.style.stroke = '#10b981';
                display.classList.remove('text-red-400');
                display.classList.add('text-emerald-400');
            }
        }

        function hideTimer() {
            const modal = document.getElementById('timer-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function playTimerEnd() {
            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
            // Play beep sound
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.frequency.value = 880;
                oscillator.type = 'sine';
                gainNode.gain.value = 0.3;
                oscillator.start();
                setTimeout(() => oscillator.stop(), 300);
            } catch (e) { }
        }

        // Timer event listeners
        document.getElementById('timer-skip-btn').addEventListener('click', hideTimer);
        document.getElementById('timer-add-btn').addEventListener('click', () => {
            currentTimerSeconds += 30;
            totalTimerSeconds += 30;
            updateTimerDisplay();
        });

        // --- MUSCLE MAP GENERATOR ---
        const getMuscleMapSVG = (primary = [], secondary = []) => {
            const getColor = (muscleId) => {
                if (primary.includes(muscleId)) return "#ef4444"; // Red-500
                if (secondary.includes(muscleId)) return "#eab308"; // Yellow-500
                return "#334155"; // Slate-700
            };

            // SVG Content (Same paths as React component)
            return `
            <div class="flex gap-2 h-32 w-full justify-center opacity-90 transition-opacity duration-500 hover:opacity-100">
                <svg viewBox="0 0 100 200" class="h-full w-auto drop-shadow-lg">
                    <circle cx="50" cy="20" r="12" fill="#1e293b" />
                    <path d="M38,32 Q50,40 62,32 L65,35 L35,35 Z" fill="${getColor('traps')}" />
                    <path d="M25,35 Q30,30 38,32 L38,45 Q25,50 22,40 Z" fill="${getColor('shoulders')}" />
                    <path d="M75,35 Q70,30 62,32 L62,45 Q75,50 78,40 Z" fill="${getColor('shoulders')}" />
                    <path d="M38,32 Q50,45 62,32 L62,55 Q50,65 38,55 Z" fill="${getColor('chest')}" />
                    <path d="M22,40 Q25,50 20,60 L28,60 Q30,50 38,45 Z" fill="${getColor('biceps')}" />
                    <path d="M78,40 Q75,50 80,60 L72,60 Q70,50 62,45 Z" fill="${getColor('biceps')}" />
                    <path d="M20,60 L18,80 L26,80 L28,60 Z" fill="${getColor('forearms')}" />
                    <path d="M80,60 L82,80 L74,80 L72,60 Z" fill="${getColor('forearms')}" />
                    <path d="M38,55 Q50,65 62,55 L60,85 Q50,90 40,85 Z" fill="${getColor('abs')}" />
                    <path d="M38,55 L35,80 L40,85 L38,55 Z" fill="${getColor('obliques')}" />
                    <path d="M62,55 L65,80 L60,85 L62,55 Z" fill="${getColor('obliques')}" />
                    <path d="M35,85 Q25,100 30,135 L48,135 Q50,100 45,85 Z" fill="${getColor('quads')}" />
                    <path d="M65,85 Q75,100 70,135 L52,135 Q50,100 55,85 Z" fill="${getColor('quads')}" />
                    <path d="M32,140 Q28,155 32,170 L46,170 Q48,155 46,140 Z" fill="${getColor('calves')}" />
                    <path d="M68,140 Q72,155 68,170 L54,170 Q52,155 54,140 Z" fill="${getColor('calves')}" />
                </svg>
                <svg viewBox="0 0 100 200" class="h-full w-auto drop-shadow-lg">
                    <circle cx="50" cy="20" r="12" fill="#1e293b" />
                    <path d="M35,32 L65,32 L50,55 Z" fill="${getColor('traps')}" />
                    <path d="M25,35 Q30,30 35,32 L35,45 Q25,50 22,40 Z" fill="${getColor('shoulders')}" />
                    <path d="M75,35 Q70,30 65,32 L65,45 Q75,50 78,40 Z" fill="${getColor('shoulders')}" />
                    <path d="M35,45 L28,65 Q35,75 50,85 Q65,75 72,65 L65,45 L50,55 Z" fill="${getColor('lats')}" />
                    <path d="M42,85 L58,85 L55,95 L45,95 Z" fill="${getColor('lower_back')}" />
                    <path d="M22,40 Q18,50 20,60 L28,60 Q30,50 35,45 Z" fill="${getColor('triceps')}" />
                    <path d="M78,40 Q82,50 80,60 L72,60 Q70,50 65,45 Z" fill="${getColor('triceps')}" />
                    <path d="M35,95 Q25,105 35,120 L50,120 L50,95 Z" fill="${getColor('glutes')}" />
                    <path d="M65,95 Q75,105 65,120 L50,120 L50,95 Z" fill="${getColor('glutes')}" />
                    <path d="M35,120 Q30,135 32,150 L48,150 Q48,135 45,120 Z" fill="${getColor('hamstrings')}" />
                    <path d="M65,120 Q70,135 68,150 L52,150 Q52,135 55,120 Z" fill="${getColor('hamstrings')}" />
                    <path d="M32,152 Q25,165 34,180 L46,180 Q48,165 46,152 Z" fill="${getColor('calves')}" />
                    <path d="M68,152 Q75,165 66,180 L54,180 Q52,165 54,152 Z" fill="${getColor('calves')}" />
                </svg>
            </div>
            `;
        };

        // --- INIT & RENDER FUNCTIONS ---

        function init() {
            // Set Date
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('es-AR', options);

            renderTabs();
            renderContent();
            lucide.createIcons();
        }

        function renderTabs() {
            const container = document.getElementById('tabs-container');
            container.innerHTML = '';

            routineData.forEach((day, index) => {
                const isActive = index === activeTab;
                const btn = document.createElement('button');

                // Tailwind classes for buttons
                let classes = "flex-shrink-0 md:w-full text-left px-4 py-3 rounded-xl transition-all duration-300 flex items-center justify-between group border relative overflow-hidden ";
                if (isActive) {
                    classes += "bg-emerald-500/10 border-emerald-500 text-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.15)] translate-x-1";
                } else {
                    classes += "bg-slate-900 border-slate-800 text-slate-400 hover:bg-slate-800 hover:text-slate-200 hover:border-slate-700";
                }
                btn.className = classes;

                btn.onclick = () => {
                    activeTab = index;
                    renderTabs();
                    renderContent();
                };

                // Inner HTML
                btn.innerHTML = `
                    ${isActive ? '<div class="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-transparent opacity-50"></div>' : ''}
                    <div class="flex flex-col relative z-10">
                        <span class="text-xs font-bold uppercase tracking-wider mb-1 transition-colors ${isActive ? 'text-emerald-300' : 'text-slate-500'}">${day.day}</span>
                        <span class="font-medium text-sm truncate w-32 md:w-auto">${day.title}</span>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 transition-all duration-300 relative z-10 ${isActive ? 'text-emerald-500 translate-x-0' : 'opacity-0 -translate-x-2 group-hover:opacity-100 group-hover:translate-x-0'}"></i>
                `;

                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        function renderContent() {
            const dayData = routineData[activeTab];

            // Update Headers & Progress
            document.getElementById('day-title').textContent = dayData.title;
            document.getElementById('exercise-count').textContent = `${dayData.exercises.length} Ejercicios`;

            // Calculate total sets and completed sets for progress
            let totalSets = 0;
            let completedSetsCount = 0;
            dayData.exercises.forEach((exercise, idx) => {
                const numSets = parseInt(exercise.sets) || 3;
                totalSets += numSets;
                for (let s = 0; s < numSets; s++) {
                    if (completedSets[`${activeTab}-${idx}-${s}`]) {
                        completedSetsCount++;
                    }
                }
            });
            const progress = totalSets === 0 ? 0 : Math.round((completedSetsCount / totalSets) * 100);

            const progressContainer = document.getElementById('progress-container');
            progressContainer.classList.remove('hidden');

            // Progress Bar Animation
            const progressBar = document.getElementById('progress-bar');
            document.getElementById('progress-text').textContent = `${progress}%`;
            progressBar.style.width = '0%';
            setTimeout(() => {
                progressBar.style.width = `${progress}%`;
            }, 50);

            // Completion Message
            const completionMsg = document.getElementById('completion-message');
            if (progress === 100) {
                completionMsg.classList.remove('hidden');
            } else {
                completionMsg.classList.add('hidden');
            }

            // Render Exercises
            const listContainer = document.getElementById('exercises-list');
            listContainer.innerHTML = '';

            dayData.exercises.forEach((exercise, idx) => {
                const numSets = parseInt(exercise.sets) || 3;
                const restTime = parseRestTime(exercise.notes || '');

                // Count completed sets for this exercise
                let exerciseCompletedSets = 0;
                for (let s = 0; s < numSets; s++) {
                    if (completedSets[`${activeTab}-${idx}-${s}`]) {
                        exerciseCompletedSets++;
                    }
                }
                const isExerciseCompleted = exerciseCompletedSets === numSets;

                const card = document.createElement('div');
                const staggerClass = idx < 6 ? `stagger-${idx + 1}` : '';

                let cardClasses = `animate-slide-up ${staggerClass} relative group p-0 rounded-2xl border transition-all duration-300 overflow-hidden flex flex-col md:flex-row `;

                if (isExerciseCompleted) {
                    cardClasses += "bg-slate-900/40 border-slate-800/50 opacity-80 scale-[0.99]";
                } else {
                    cardClasses += "bg-slate-900 border-slate-800 hover:border-slate-700 hover:shadow-xl hover:shadow-emerald-900/10";
                }
                card.className = cardClasses;

                const muscleMapHTML = getMuscleMapSVG(exercise.muscles.primary, exercise.muscles.secondary);

                // Generate set buttons HTML
                let setButtonsHTML = '';
                for (let s = 0; s < numSets; s++) {
                    const setKey = `${activeTab}-${idx}-${s}`;
                    const isSetCompleted = completedSets[setKey];
                    setButtonsHTML += `
                        <button data-set-key="${setKey}" data-exercise-name="${exercise.name}" data-rest-time="${restTime}"
                            class="set-btn w-10 h-10 rounded-lg font-bold text-sm transition-all duration-200 flex items-center justify-center
                            ${isSetCompleted
                            ? 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/30'
                            : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-emerald-400 hover:scale-105'}">
                            ${isSetCompleted ? '✓' : (s + 1)}
                        </button>
                    `;
                }

                card.innerHTML = `
                    <!-- Completion Strip -->
                    <div class="absolute left-0 top-0 bottom-0 w-1 z-10 transition-colors duration-300 ${isExerciseCompleted ? 'bg-emerald-500' : 'bg-transparent group-hover:bg-slate-700'}"></div>

                    <!-- Left Info -->
                    <div class="flex-1 p-5">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 rounded-lg transition-colors duration-300 ${isExerciseCompleted ? 'bg-emerald-500/20 text-emerald-400' : 'bg-slate-800 text-slate-300 group-hover:bg-slate-700'}">
                                        <i data-lucide="dumbbell" class="w-5 h-5 ${isExerciseCompleted ? 'animate-pulse' : ''}"></i>
                                    </div>
                                    <h3 class="font-bold text-lg transition-all duration-300 ${isExerciseCompleted ? 'text-slate-500 line-through decoration-slate-600 decoration-2' : 'text-slate-100 group-hover:text-emerald-300'}">
                                        ${exercise.name}
                                    </h3>
                                </div>
                                
                                <!-- Sets Row -->
                                <div class="mt-4 mb-3">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-slate-500 text-xs uppercase font-bold tracking-wider">Series</span>
                                        <span class="text-xs text-slate-600">(${exerciseCompletedSets}/${numSets})</span>
                                        <div class="flex-1 h-1 bg-slate-800 rounded-full overflow-hidden ml-2">
                                            <div class="h-full bg-emerald-500 transition-all duration-300" style="width: ${(exerciseCompletedSets / numSets) * 100}%"></div>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 flex-wrap">
                                        ${setButtonsHTML}
                                    </div>
                                </div>

                                <div class="grid grid-cols-3 gap-x-4 gap-y-2 text-sm transition-opacity duration-300 ${isExerciseCompleted ? 'opacity-50' : 'opacity-100'}">
                                    <div class="flex flex-col">
                                        <span class="text-slate-500 text-xs uppercase font-bold tracking-wider">Reps</span>
                                        <span class="font-mono text-white font-medium">${exercise.reps}</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-slate-500 text-xs uppercase font-bold tracking-wider">Intensidad</span>
                                        <span class="text-orange-400 font-medium">${exercise.rir}</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-slate-500 text-xs uppercase font-bold tracking-wider">Descanso</span>
                                        <span class="text-cyan-400 font-medium">${restTime >= 60 ? Math.floor(restTime / 60) + ' min' : restTime + 's'}</span>
                                    </div>
                                </div>

                                ${exercise.notes ? `
                                <div class="mt-3 pt-3 border-t border-slate-800/50 transition-opacity duration-300 ${isExerciseCompleted ? 'opacity-40' : 'opacity-100'}">
                                    <p class="text-slate-400 text-sm italic flex items-start gap-1.5">
                                        <span class="text-emerald-500 not-italic font-bold">Tip:</span> 
                                        ${exercise.notes.replace(/Descanso:.*?(min|seg)\.?/gi, '').trim()}
                                    </p>
                                </div>` : ''}
                            </div>

                            <div class="mt-1">
                                ${isExerciseCompleted
                        ? `<i data-lucide="check-circle-2" class="w-8 h-8 text-emerald-500 fill-emerald-500/20 animate-pop drop-shadow-[0_0_8px_rgba(16,185,129,0.5)]"></i>`
                        : `<i data-lucide="circle" class="w-8 h-8 text-slate-700 group-hover:text-emerald-500/50 transition-all duration-300 transform group-hover:scale-110"></i>`
                    }
                            </div>
                        </div>
                    </div>

                    <!-- Muscle Map -->
                    <div class="w-full md:w-32 bg-slate-950/50 border-t md:border-t-0 md:border-l border-slate-800 p-2 flex flex-col items-center justify-center transition-opacity duration-300 ${isExerciseCompleted ? 'opacity-50 grayscale' : ''}">
                        <span class="text-[10px] uppercase text-slate-500 font-bold mb-1 tracking-wider text-center">Impacto Muscular</span>
                        ${muscleMapHTML}
                        <div class="flex gap-2 mt-2 justify-center">
                            <div class="flex items-center gap-1">
                                <div class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_5px_rgba(239,68,68,0.5)]"></div>
                                <span class="text-[9px] text-slate-400">1º</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <div class="w-2 h-2 rounded-full bg-yellow-500 shadow-[0_0_5px_rgba(234,179,8,0.5)]"></div>
                                <span class="text-[9px] text-slate-400">2º</span>
                            </div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });

            // Add event listeners to set buttons
            document.querySelectorAll('.set-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const setKey = btn.dataset.setKey;
                    const exerciseName = btn.dataset.exerciseName;
                    const restTime = parseInt(btn.dataset.restTime);

                    if (!completedSets[setKey]) {
                        // Mark as completed
                        completedSets[setKey] = true;
                        localStorage.setItem('gymRoutineSets', JSON.stringify(completedSets));
                        renderContent();
                        // Start timer
                        showTimer(exerciseName, restTime);
                    } else {
                        // Toggle off (unmark)
                        completedSets[setKey] = false;
                        localStorage.setItem('gymRoutineSets', JSON.stringify(completedSets));
                        renderContent();
                    }
                });
            });

            // Re-init icons for newly added elements
            lucide.createIcons();
        }

        // Init App
        init();

    </script>
</body>

</html>